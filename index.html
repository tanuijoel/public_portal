<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wasreb</title>
    <link href="styles.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/flowbite@1.5.3/dist/flowbite.min.css" />
    <script src="https://unpkg.com/flowbite@1.5.3/dist/flowbite.js" defer></script>
    <!-- Map Scripts -->
    <script src="./script/circular-progress.js" defer type="module"></script>
	<link rel="stylesheet" href="https://openlayers.org/en/v6.2.1/css/ol.css" type="text/css">
    <!-- Openlayers -->
    <link rel="stylesheet" href="https://openlayers.org/en/latest/legacy/ol.css" />
    <!-- ol-ext -->
    <link rel="stylesheet" href="./dist/ol-ext.min.css" />
    <style>
        #map {
          width: 100%;
          height: 930px;
        }
     </style>
  </head>
    <body class="font-body min-h-screen flex flex-col justify-center align-middle">
        <header class="border-b border-slate-300">
            <div class="container mx-auto py-6 flex justify-between">
                <div class="basis-3/10"><img src="./img/wasreb-logo.png" class="h-12"></div>

                <div class="basis-7/10 flex justify-end">
                    <div class="basis-1/4 mr-2 flex justify-end">
                        <input placeholder="Search/Filter ..." type="search" name="search" id="main-search">
                    </div>
                    <nav class="basis1/2">
                        <ul class="m-0 p-0 list-none bg-slate-800 text-slate-100 uppercase rounded-md overflow-hidden mt-2">
                            <li class="inline-block py-2.5 px-12 bg-slate-700 hover:bg-slate-600 transition ease-in-out text-sm font-medium cursor-pointer" data-modal-toggle="request-for-data-modal">
                                Request for data
                            </li>
                            <li class="inline-block py-2.5 px-6 text-sm font-medium bg-slate-800 hover:bg-slate-600 transition ease-in-out cursor-pointer" data-modal-toggle="contact-us-modal">
                                Contact Us
                            </li>
                        </ul>
                    </nav>
                </div>

               
            </div>

           
        </header>
        <main class="flex-grow relative">
            <div class="w-full">
                <div id="map"></div>
            </div>
            <nav id="layers" style="margin-top: 15px;" class="z-40 w-[22rem] absolute top-12 left-0 bg-slate-700/95 py-2 px-4 rounded-r-md border-t border-r border-b border-slate-200 shadow-md">
                <div id="layers-toggle" class="cursor-pointer">
                    <div class="flex justify-between mt-1">
                        <div class="flex justify-start">
                            <div class="mr-4">
                                <svg class="h-5 w-5 text-slate-200" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg"
                                    xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 384 384"
                                    style="enable-background:new 0 0 384 384;" xml:space="preserve">
                                    <style type="text/css">
                                        .st0 {
                                            fill: #FFFFFF;
                                        }
                                    </style>
                                    <g>
                                        <path class="st0"
                                            d="M0,129.7c0-4,0-8,0-12c0.2-0.5,0.5-0.9,0.6-1.4c2.9-17.8,12.8-30.4,28.7-38.8C66.6,58,103.7,37.9,141.2,18.5
                                                            		c32.6-17,65.9-17.5,99-1.3C253.6,23.7,266.7,31,280,38c25.4,13.4,50.8,26.8,76.1,40.3c13.2,7,21.9,17.5,26,31.8
                                                            		c0.7,2.5,1.2,5.1,1.9,7.6c0,4,0,8,0,12c-0.2,0.3-0.5,0.6-0.5,1c-2.9,18.3-13.2,30.9-29.4,39.5c-36.4,19.3-72.6,38.9-108.9,58.4
                                                            		c-34,18.2-68.6,19.4-103,1.6c-39.1-20.3-77.8-41.4-116.5-62.4c-12.2-6.6-20-17.1-23.8-30.4C1.2,134.8,0.6,132.3,0,129.7z
                                                            		 M192.4,212.6c12.7,0.1,25-3.2,36.5-9.4c37.6-20.2,75.2-40.4,112.8-60.5c7.7-4.1,12.2-10.3,12.1-19.2c0-8.7-4.4-14.8-12.1-18.8
                                                            		c-38.1-20.1-76-40.5-114.2-60.3c-23.9-12.4-48.3-12-72.2,0.5c-37.7,19.7-75.2,39.8-112.9,59.6c-7.7,4.1-12.4,10.1-12.4,19
                                                            		c-0.1,9,4.6,15.2,12.4,19.4c37.4,20,74.8,40.1,112.2,60.2C166.3,209.2,178.7,212.6,192.4,212.6z" />
                                        <path class="st0" d="M384,216.7c-2.1,5.9-6.6,9.2-12,12.1c-42.3,22.5-84.5,45.3-126.7,67.9c-35.4,18.9-70.9,19-106.3,0.1
                                                            		c-42.3-22.5-84.6-45-127-67.3c-5.4-2.8-9.8-6.2-12-12.1c0-2.3,0-4.5,0-6.8c2.1-5.3,5.3-9.6,11.2-11.1c4.6-1.2,8.8,0.1,12.9,2.3
                                                            		c42.8,22.8,85.8,45.4,128.6,68.3c26.4,14.2,52.6,14.1,79-0.2c42.1-22.8,84.4-45.3,126.7-68c12.4-6.7,19.6-4.4,25.7,7.9
                                                            		C384,212.2,384,214.5,384,216.7z" />
                                        <path class="st0" d="M0,278.2c2.1-5.3,5.3-9.6,11.2-11.1c4.6-1.2,8.8,0.1,12.9,2.3c42.9,22.8,85.8,45.4,128.6,68.3
                                                            		c26.5,14.2,52.6,14.1,79-0.1c42.2-22.8,84.4-45.3,126.6-68c12.4-6.7,19.6-4.4,25.7,7.9c0,2.3,0,4.5,0,6.8c-2.1,5.9-6.6,9.2-12,12.1
                                                            		c-42.4,22.6-84.7,45.4-127,68.1c-35.3,18.8-70.7,18.7-106,0c-42.3-22.5-84.6-45-127-67.3c-5.4-2.8-9.8-6.2-12-12.1
                                                            		C0,282.7,0,280.5,0,278.2z" />
                                    </g>
                                </svg>
                            </div>
                            <div>
                                <p class="uppercase text-white font-bold">Layers</p>
                            </div>
                        </div>
                        <div>
                            <svg class="w-6 h-6 text-slate-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </div>
                    </div>
                </div>
                <div id="layer-items"  style="font-family:inherit!important; width: fit-content !important; height: fit-content !important;  font-size: 13px; color: white" class="mt-10 py-4 border-t border-slate-500 all_layers hidden">
                    
                    <!-- <div class="flex items-center mb-4">
                        <input id="default-checkbox" type="checkbox" value="" class="w-4 h-4 mr-4 text-slate-700 bg-slate-100 rounded border-slate-300 focus:ring-slate-500 focus:ring-2">
                        <label for="default-checkbox" class="text-white flex justify-start pt-1">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4">
                                </path>
                            </svg>
                            Water service providers
                        </label>
                    </div> -->
                   
                    <!-- <div class="flex items-center mb-4">
                        <input id="default-checkbox" type="checkbox" value="" class="w-4 h-4 mr-4 text-slate-700 bg-slate-100 rounded border-slate-300 focus:ring-slate-500 focus:ring-2">
                        <label for="default-checkbox" class="text-white flex justify-start pt-1">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4">
                                </path>
                            </svg>
                            Small Scale service providers
                        </label>
                    </div> -->
                    
                    <!-- <div class="flex items-center mb-4">
                        <input id="default-checkbox" type="checkbox" value="" class="w-4 h-4 mr-4 text-slate-700 bg-slate-100 rounded border-slate-300 focus:ring-slate-500 focus:ring-2">
                        <label for="default-checkbox" class="text-white flex justify-start pt-1">
                            <svg class="w-5 h-5 mr-2" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg"
                            xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 384 384"
                            style="enable-background:new 0 0 384 384;" xml:space="preserve">
                            <style type="text/css">
                                .st0 {
                                    fill: #FFFFFF;
                                }
                            </style>
                            <g>
                                <path class="st0" d="M140.7,384c-7.3-2-14.6-4.1-20.7-8.9c-11.7-9.1-17.9-20.9-18.2-35.7c-0.2-13.1,0-26.2-0.2-39.4
                                            		c0-1.7-1.1-3.9-2.3-4.9c-30.5-24.6-49.2-56.2-55.6-95c-1.2-7.5-1.5-15.1-2.3-23.1c-4.3,0-8.9,0-13.5,0c-9.3-0.1-16.1-6.4-16-15.2
                                            		c0.1-8.6,6.8-14.8,15.9-14.8c109.1,0,218.3,0,327.4,0c9.2,0,15.9,6.2,15.9,14.8c0.1,8.7-6.6,15.1-16,15.2c-4.5,0-9,0-13.6,0
                                            		c-0.6,6.7-0.9,13.3-1.8,19.8c-5.5,39.9-24.2,72.5-55.5,97.8c-2.1,1.7-3.1,3.4-3.1,6.2c0.2,12.1,0.1,24.2,0.1,36.4
                                            		c0,23.9-14.3,41.4-37.6,46.2c-0.5,0.1-0.9,0.4-1.3,0.6C208.6,384,174.7,384,140.7,384z M311.4,177.3c-80.1,0-159.7,0-239.4,0
                                            		c0,2.3-0.2,4.3,0,6.2c0.6,5.5,1.2,10.9,2.1,16.3c7.6,44.1,44.5,83.1,88,93.5c14.2,3.4,28.5,4.3,43.1,3c8.9-0.8,15.8,5.5,16.3,13.9
                                            		c0.5,8.5-5.7,15.2-14.8,16.1c-24.9,2.4-49-1.1-72.1-10.6c-0.8-0.3-1.7-0.5-2.9-0.8c0,7.8,0,15.2,0,22.5c0,10.6,6.1,16.6,16.8,16.6
                                            		c28.7,0,57.4,0,86.1,0c10.9,0,16.9-6,16.9-16.9c0-15.7,0-31.5,0-47.2c0-5.5,2.1-10,6.7-13.1c11.8-7.8,21.6-17.6,30-29
                                            		C303.5,226.9,311.1,203.5,311.4,177.3z" />
                                <path class="st0" d="M329.4,0c1,0.4,2,0.9,3.1,1.3c6.3,2.8,10,9.6,8.7,16.2c-1.3,7-7,12.1-14,12.4c-5.1,0.2-10.2,0-15.7,0
                                            		c0,1.6,0,3,0,4.3c0,22.4,0.1,44.7,0,67.1c0,11.1-10.3,18.4-20.3,14.6c-5.9-2.3-9.6-7.7-9.6-14.7c0-22.2,0-44.5,0-66.7
                                            		c0-1.4,0-2.7,0-4.3c-59.9,0-119.5,0-179.6,0c0,1.3,0,2.7,0,4c0,22.4,0,44.7,0,67.1c0,11-9.9,18.3-19.9,14.8
                                            		c-6.1-2.1-10-7.7-10-14.8c0-22.5,0-45,0-67.5c0-1.1,0-2.2,0-3.9c-4.5,0-8.8,0-13.1,0c-9.1,0-15.2-4.6-16.7-12.4
                                            		c-1.4-7.5,2.8-14,11.2-17.1c0.2-0.1,0.4-0.3,0.6-0.4C145.7,0,237.5,0,329.4,0z" />
                                <path class="st0" d="M161.7,90c-5,0-10,0.1-14.9,0c-8.5-0.2-15-6.7-15-15c0-8.3,6.5-14.9,15-15c10-0.1,19.9-0.1,29.9,0
                                            		c8.5,0.1,15,6.7,15,14.9c0,8.3-6.5,14.8-15,15C171.7,90.1,166.7,90,161.7,90z" />
                            </g>
                        </svg>
                           Sanitation facilities
                        </label>
                    </div> -->

                    <!-- <div class="flex items-center mb-4">
                        <input id="default-checkbox" type="checkbox" value="" class="w-4 h-4 mr-4 text-slate-700 bg-slate-100 rounded border-slate-300 focus:ring-slate-500 focus:ring-2">
                        <label for="default-checkbox" class="text-white flex justify-start pt-1">
                            <svg class="w-5 h-5 mr-2" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg"
                            xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 384 384"
                            style="enable-background:new 0 0 384 384;" xml:space="preserve">
                            <style type="text/css">
                                .st0 {
                                    fill: #FFFFFF;
                                }
                            </style>
                            <g>
                                <path class="st0"
                                    d="M199.1,0c7.6,1.7,15.5,2.7,22.9,5.1c44,14.1,73.3,57.5,69.8,102.6c-3.8,47.9-38.2,85.9-84.7,93.5
                                            		c-57.4,9.3-110.7-31.7-116.7-89.7C84.8,56.3,124.9,6.5,179.8,0.7c1-0.1,1.9-0.4,2.9-0.7C188.1,0,193.6,0,199.1,0z M191.1,30
                                            		c-39.2-0.1-71.2,31.9-71.3,71.2c0,39.1,31.7,71.2,70.7,71.3c39.3,0.1,71.4-31.7,71.5-71C262.1,62.2,230.2,30.1,191.1,30z" />
                                <path class="st0" d="M321.9,384c-8.6-2.9-12-8.9-12.1-17.9c-0.7-49.8-38.8-94.5-88-101.8c-23.6-3.5-47.5-3.9-70.8,2.7
                                            		c-40.4,11.4-71.6,49-75.5,90.9c-0.2,2.6-0.7,5.2-0.5,7.8c0.5,9.2-3.3,15.3-12.1,18.3c-2,0-4,0-6,0c-9.8-4.3-12.1-7.9-11.9-19.1
                                            		c1.1-60.7,45.9-116.3,105.3-128.6c33.3-6.9,67.2-7.7,99.6,4.5c49.4,18.6,78.6,55,88.3,106.9c1.1,5.7,1.4,11.7,1.6,17.5
                                            		c0.4,10.8-2.1,14.4-11.9,18.7C325.9,384,323.9,384,321.9,384z" />
                            </g>
                        </svg>
                           Population
                        </label>
                    </div> -->

                    <!-- <div class="flex items-center mb-4">
                        <input id="default-checkbox" type="checkbox" value="" class="w-4 h-4 mr-4 text-slate-700 bg-slate-100 rounded border-slate-300 focus:ring-slate-500 focus:ring-2">
                        <label for="default-checkbox" class="text-white flex justify-start pt-1">
                            <svg class="w-5 h-5 mr-2" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg"
                            xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 384 384"
                            style="enable-background:new 0 0 384 384;" xml:space="preserve">
                            <style type="text/css">
                                .st0 {
                                    fill: #FFFFFF;
                                }
                            </style>
                            <g>
                                <path class="st0" d="M18,0c9,3,12.7,9.4,12,18.7c-0.3,4.4,0,8.9,0,13.9c10.6-3.7,21.2-2.5,31.6-2.5c23.7-0.1,47.5-0.2,71.2,0
                                            		c61.6,0.5,114.3,41.8,129.9,101.4c2.9,11.2,4.3,22.6,4.3,34.1c0,9.5,0,19,0,28.5c0,9.7,6.3,15.9,15.9,16c8.4,0,16.7,0,25.1,0
                                            		c9.2,0,15.9,6.3,15.9,14.9c0.1,8.6-6.6,15.1-15.7,15.1c-11.1-0.1-22.3,0.6-33.3-0.8c-21.6-2.7-37.7-21.8-38-43.6
                                            		c-0.2-13.9,0.4-27.8-0.8-41.6c-3.8-45.9-41-85.4-86.4-92.4c-6.3-1-12.7-1.5-19-1.5c-28-0.2-56-0.1-84-0.1C36.1,60,30,66,30,76.6
                                            		c0,17,0,34,0,51c0,10.2,6.2,16.3,16.3,16.4c17.7,0,35.5,0,53.2,0c28.1,0,47.3,19.2,47.4,47.2c0,13-0.3,26,0.8,39
                                            		c3.4,40.8,34.4,78,73.9,89.3c10.5,3,21.2,4.5,32.2,4.5c18.4-0.1,36.7-0.1,55.1,0c7.3,0,12.9,4.7,14.6,11.6
                                            		c1.6,6.4-1.5,13.4-7.5,16.4c-2.3,1.1-5,1.8-7.5,1.8c-20,0.1-40,0.3-60,0C185.4,353,129.6,305,119.3,242.7
                                            		c-1.4-8.3-1.8-16.9-2.2-25.3c-0.4-9.1,0-18.2-0.1-27.4c0-9.7-6.3-16-15.9-16c-13.6,0-27.2,0.1-40.9,0c-9.9-0.1-20,1.1-30.2-2.6
                                            		c0,5.5,0,10.4,0,15.4c0,9.4-4.5,15.6-12.4,17.1c-7.4,1.4-13.7-2.7-17.2-11.1c-0.1-0.2-0.2-0.4-0.4-0.7C0,132,0,72,0,12
                                            		C1.9,5.9,5.9,1.9,12,0C14,0,16,0,18,0z" />
                                <path class="st0" d="M366,384c-9-3-12.1-9.4-12.1-18.7c0.2-56,0.1-112.1,0.1-168.1c0-2.1,0.1-4.3,0.6-6.3
                                            		c1.6-6.1,6.8-10.3,12.9-10.9c6.2-0.6,12.2,2.8,15,8.5c0.5,1.1,1,2.3,1.5,3.4c0,60,0,120,0,180c-1.9,6.1-5.9,10.1-12,12
                                            		C370,384,368,384,366,384z" />
                            </g>
                        </svg>
                        Pipeline/Networks
                        </label>
                    </div> -->
               
                    <div class="external layerSwitcher" style="margin-bottom: 100px;"></div>
               
                </div>
            </nav>

            <nav id="indicators" style="margin-top: 15px;" class=" z-40 w-72 absolute top-12 right-0 bg-slate-50 py-2 px-4 rounded-l-md border-l border-t border-b border-slate-500 shadow-md">
                <div id="indicators-toggle" class="cursor-pointer">
                    <div class="flex justify-between">
                        <div class="flex justify-start">
                            <div class="mr-4">
                                <svg class="w-5 h-5 mr-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"></path>
                                </svg>
                            </div>
                            <div>
                                <p class="uppercase text-slate-800 font-bold">indicators</p>
                            </div>
                        </div>
                        <div>
                            <svg class="w-6 h-6 text-slate-800" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <div id="indicators-container" class="hidden indicators-container">
                    <!-- Start National Level -->
                    <div id="national_level">
                    <div id="indicator-items" class="border-t border-slate-400 my-2 py-2">
                        <h3 class="text-slate-700 text-center font-bold">Analytics</h3>
                        <!-- <div class="flex justify-between my-8">
                            <div class="basis-2/5 flex flex-col justify-center">
                                <div data-end-value="57" class="circular-progress circular-progress-small mx-auto">
                                    <div class="value-container value-container-small text-slate-600">0%</div>
                                </div>
                            </div>
                            <div class="basis-3/5">
                                <div id="sector-benchmarks" class="text-center">
                                    <h2 class="font-bold uppercase text-center text-xs border-b border-slate-300 mb-2">Sector benchmarks
                                    </h2>
                                    <div id="benchmarks">
                                        <div class="benchmark-small bg-red-500 border border-red-300">
                                            <p class="benchmark-small-text p-0 m-0">&lt; 80</p>
                                            <p class="benchmark-small-text p-0 m-0">Not acceptable</p>
                                        </div>
                                        <div class="benchmark-small bg-yellow-300 border border-yellow-200">
                                            <p class="benchmark-small-text p-0 m-0">80 - 90</p>
                                            <p class="benchmark-small-text p-0 m-0">Acceptable</p>
                                        </div>
                                        <div class="benchmark-small bg-green-400 border border-green-200">
                                            <p class="benchmark-small-text p-0 m-0">&gt; 90</p>
                                            <p class="benchmark-small-text p-0 m-0">Good</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div> -->
                        <hr>
                        <!-- <div id="not_national" class="flex justify-between my-8">
                            <div class="basis-2/5 flex flex-col justify-center">
                                <div data-end-value="57" class="circular-progress circular-progress-small mx-auto">
                                    <div class="value-container value-container-small text-slate-600">0%</div>
                                </div>
                            </div>
                            <div class="basis-3/5">
                                <div id="sector-benchmarks" class="text-center">
                                    <h2 class="font-bold uppercase text-center text-xs border-b border-slate-300 mb-2">Sector benchmarks
                                    </h2>
                                    <div id="benchmarks">
                                        <div class="benchmark-small bg-red-500 border border-red-300">
                                            <p class="benchmark-small-text p-0 m-0">&lt; 80</p>
                                            <p class="benchmark-small-text p-0 m-0">Not acceptable</p>
                                        </div>
                                        <div class="benchmark-small bg-yellow-300 border border-yellow-200">
                                            <p class="benchmark-small-text p-0 m-0">80 - 90</p>
                                            <p class="benchmark-small-text p-0 m-0">Acceptable</p>
                                        </div>
                                        <div class="benchmark-small bg-green-400 border border-green-200">
                                            <p class="benchmark-small-text p-0 m-0">&gt; 90</p>
                                            <p class="benchmark-small-text p-0 m-0">Good</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div> -->
    
                        <div id="metrics">
                            <div class="metric-container">
                                <!-- <div class="metric-element border border-slate-300">
                                    <img src="./img/icons/drinking-water-01.svg" class="h-4 w-4 mx-auto">
                                </div> -->
                                <div class="flex flex-col justify-center">
                                    <p class="ml-4 metric-label text-xs">Water Coverage %</p>
                                </div>
                                <!-- bg-red-500 -->
                                <div class="metric-element ">
                                    <p id="national_wc" style="color:black;">0</p>
                                </div>
                            </div>
                            <div class="metric-container">
                                <!-- <div class="metric-element border border-slate-300">
                                    <img src="./img/icons/drinking-water-01.svg" class="h-4 w-4 mx-auto">
                                </div> -->
                                <div class="flex flex-col justify-center">
                                    <p class="ml-4 metric-label text-xs">Non Revenue Water %</p>
                                </div>
                                <!-- bg-red-500 -->
                                <div class="metric-element ">
                                    <p id="national_nrw" style="color:black;">0</p>
                                </div>
                            </div>
                            <div class="metric-container">
                                <!-- <div class="metric-element border border-slate-300">
                                    <img src="./img/icons/drinking-water-01.svg" class="h-4 w-4 mx-auto">
                                </div> -->
                                <div class="flex flex-col justify-center">
                                    <p class="ml-4 metric-label text-xs">Metering Ratio %</p>
                                </div>
                                <!-- bg-red-500 -->
                                <div class="metric-element ">
                                    <p id="national_metering_ratio" style="color:black;">0</p>
                                </div>
                            </div>
    
                            <!-- <div class="metric-container">
                                <div class="metric-element border border-slate-300">
                                    <img src="./img/icons/clock-04.svg" class="h-4 w-4 mx-auto">
                                </div>
                                <div class="flex flex-col justify-center">
                                    <p class="metric-label text-xs">Staff Productivity</p>
                                </div>
                                <div class="metric-element bg-amber-500">
                                    <p id="staff_productivity">0</p>
                                </div>
                            </div> -->
                          <!-- 
                            <div class="metric-container">
                                <div class="metric-element border border-slate-300">
                                    <img src="./img/icons/cost-coverage-01.svg" class="h-4 w-4 mx-auto">
                                </div>
                                <div class="flex flex-col justify-center">
                                    <p class="metric-label text-xs">Metring Ratio %</p>
                                </div>
                                <div class="metric-element bg-green-500">
                                    <p class="p-10" id="metering_ratio">0</p>
                                </div>
                            </div> -->
                        </div>
                    </div>
                    <div class="bg-slate-700 mt-4 -mx-4 -mb-2 p-4 text-slate-400 flex justify-between rounded-md">
                        <div class="basis-1/2">
                            <div class="mb-6">
                             <p class="meta-label">Total population served</p>
                             <p id="population_served" class="font-bold text-1xl">0</p>
                            </div>
    
                             <div>
                                 <p class="meta-label">Total active water connections</p>
                                 <p id="active_water_connections" class="font-bold text-1xl">0</p>
                             </div>
                         </div>
                         <div class="basis-1/2 pl-2 border-l border-slate-500">
                             <div class="mb-6">
                                 <p class="meta-label">Total population in service area</p>
                                 <p id="population_service_area" class="font-bold text-1xl">0</p>
                             </div>
                         
                             <div>
                                 <p class="meta-label">Total water produced (M<sup>3</sup>)</p>
                                 <p id="water_produced"class="font-bold text-1xl">0</p>
                             </div>
                         </div>
                       </div>
                    </div>
                   <!-- End National Level -->
                   <!-- County levels -->

                   <div id="county_level">
                    <div id="indicator-items" class="border-t border-slate-400 my-2 py-2">
                       
                        <!-- <div class="flex justify-between my-8">
                            <div class="basis-2/5 flex flex-col justify-center">
                                <div data-end-value="57" class="circular-progress circular-progress-small mx-auto">
                                    <div class="value-container value-container-small text-slate-600">0%</div>
                                </div>
                            </div>
                            <div class="basis-3/5">
                                <div id="sector-benchmarks" class="text-center">
                                    <h2 class="font-bold uppercase text-center text-xs border-b border-slate-300 mb-2">Sector benchmarks
                                    </h2>
                                    <div id="benchmarks">
                                        <div class="benchmark-small bg-red-500 border border-red-300">
                                            <p class="benchmark-small-text p-0 m-0">&lt; 80</p>
                                            <p class="benchmark-small-text p-0 m-0">Not acceptable</p>
                                        </div>
                                        <div class="benchmark-small bg-yellow-300 border border-yellow-200">
                                            <p class="benchmark-small-text p-0 m-0">80 - 90</p>
                                            <p class="benchmark-small-text p-0 m-0">Acceptable</p>
                                        </div>
                                        <div class="benchmark-small bg-green-400 border border-green-200">
                                            <p class="benchmark-small-text p-0 m-0">&gt; 90</p>
                                            <p class="benchmark-small-text p-0 m-0">Good</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div> -->
                        <hr>
                        <!-- <div id="not_national" class="flex justify-between my-8">
                            <div class="basis-2/5 flex flex-col justify-center">
                                <div data-end-value="57" class="circular-progress circular-progress-small mx-auto">
                                    <div class="value-container value-container-small text-slate-600">0%</div>
                                </div>
                            </div>
                            <div class="basis-3/5">
                                <div id="sector-benchmarks" class="text-center">
                                    <h2 class="font-bold uppercase text-center text-xs border-b border-slate-300 mb-2">Sector benchmarks
                                    </h2>
                                    <div id="benchmarks">
                                        <div class="benchmark-small bg-red-500 border border-red-300">
                                            <p class="benchmark-small-text p-0 m-0">&lt; 80</p>
                                            <p class="benchmark-small-text p-0 m-0">Not acceptable</p>
                                        </div>
                                        <div class="benchmark-small bg-yellow-300 border border-yellow-200">
                                            <p class="benchmark-small-text p-0 m-0">80 - 90</p>
                                            <p class="benchmark-small-text p-0 m-0">Acceptable</p>
                                        </div>
                                        <div class="benchmark-small bg-green-400 border border-green-200">
                                            <p class="benchmark-small-text p-0 m-0">&gt; 90</p>
                                            <p class="benchmark-small-text p-0 m-0">Good</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div> -->
    
                        <div id="metrics">
                            
                            <div class="metric-container" id="metering_ratio_county">
                                <div class="metric-element border border-slate-300">
                                    <img src="./img/icons/metering-ratio-02.svg" class="h-4 w-4 mx-auto">
                                </div>
                                <div class="flex flex-col justify-center">
                                    <p class="metric-label text-xs county_name_indicator_mr"></p>
                                </div>
                                <!-- id="meter_ratio_color_wc" -->
                                <div class="metric-element">
                                    <p class="indicator_value_mr" style="color:black">0</p>
                                </div>
                            </div> 

                            <div class="metric-container font-black" id="water_coverage_county">
                                <div class="metric-element border border-slate-300">
                                    <img src="./img/icons/drinking-water-01.svg" class="h-4 w-4 mx-auto">
                                </div>
                                <div class="flex flex-col justify-center">
                                    <p class="metric-label text-xs county_name_indicator_wc"></p>
                                </div>
                                <!-- id="water_coverage_color_wc" -->
                                <div  class="metric-element">
                                    <p class="indicator_value_wc" style="color:black">0</p>
                                </div>
                            </div> 

                            <div class="metric-container font-black" id="non_revenue_county">
                                <div class="metric-element border border-slate-300">
                                    <img src="./img/icons/revenue-collection-05.svg" class="h-4 w-4 mx-auto">
                                </div>
                                <div class="flex flex-col justify-center">
                                    <p class="metric-label text-xs county_name_indicator_nrw"></p>
                                </div>
                                <!-- id="water_coverage_color_wc" -->
                                <div  class="metric-element">
                                    <p class="indicator_value_nrw" style="color:black">0</p>
                                </div>
                            </div> 
    
                            <!-- <div class="metric-container">
                                <div class="metric-element border border-slate-300">
                                    <img src="./img/icons/clock-04.svg" class="h-4 w-4 mx-auto">
                                </div>
                                <div class="flex flex-col justify-center">
                                    <p class="metric-label text-xs">Staff Productivity</p>
                                </div>
                                <div class="metric-element bg-amber-500">
                                    <p id="staff_productivity">0</p>
                                </div>
                            </div> -->
                          <!-- 
                            <div class="metric-container">
                                <div class="metric-element border border-slate-300">
                                    <img src="./img/icons/cost-coverage-01.svg" class="h-4 w-4 mx-auto">
                                </div>
                                <div class="flex flex-col justify-center">
                                    <p class="metric-label text-xs">Metring Ratio %</p>
                                </div>
                                <div class="metric-element bg-green-500">
                                    <p class="p-10" id="metering_ratio">0</p>
                                </div>
                            </div> -->
                        </div>
                        <!-- Granular Data  -->
                        <div class="bg-slate-700 mt-4  mb-2 p-4 text-slate-400 flex justify-between rounded-md" id="water_coverage_stats">
                         <div class="basis-2/2  pl-2 border-l border-slate-500">
                             <div class="mb-6">
                                 <p class="meta-label">Total Population Served</p>
                                 <p class="population_served_wc font-bold text-1xl">0</p>
                             </div>
                             <div>
                                 <p class="meta-label">Total Population in Service Area</p>
                                 <p class="population_service_area_wc font-bold text-1xl">0</p>
                             </div>
                         </div>
                       </div>

                       <div  id="metering_ratio_stats" class="bg-slate-700 mt-4  mb-2 p-4 text-slate-400 flex justify-between rounded-md">
                        <div class="basis-2/2  pl-2 border-l border-slate-500">
                            <div class="mb-6">
                                <p class="meta-label">Total active water connections</p>
                                <p class="active_water_connections_mr font-bold text-1xl">0</p>
                            </div>
                            <div>
                                <p class="meta-label">Total Number Metered Connections</p>
                                <p class="number_metered_connections_mr font-bold text-1xl">0</p>
                            </div>
                        </div>
                      </div>

                      <div  id="non_revenue_stats" class="bg-slate-700 mt-4  mb-2 p-4 text-slate-400 flex justify-between rounded-md">
                        <div class="basis-2/2  pl-2 border-l border-slate-500">
                            <div class="mb-6">
                                <p class="meta-label">Total Water Produced</p>
                                <p class="water_produced_indicator_nrw font-bold text-1xl">0</p>
                            </div>
                            <div>
                                <p class="meta-label">Total Billed Volume</p>
                                <p class="billed_volume_indicator_nrw font-bold text-1xl">0</p>
                            </div>
                        </div>
                      </div>
                        
                     </div>
                    </div>

                   <!-- County Levels -->
                </div>
            </nav>
        </main>

        <footer>
            <!-- drawer init and toggle -->
            <div class="text-center">
                <button
                    class="hidden"
                    type="button" data-drawer-target="drawer-swipe" data-drawer-show="drawer-swipe" data-drawer-placement="bottom"
                    data-drawer-edge="true" data-drawer-edge-offset="bottom-[60px]" aria-controls="drawer-swipe">
                    About Majidata
                </button>
            </div>

            <!-- drawer component -->
            <div id="drawer-swipe"
                class="fixed z-40 w-full overflow-y-auto bg-slate-800 border-t border-slate-200 rounded-t-sm
                tabindex="-1" aria-labelledby="drawer-swipe-label">
                <div class="p-4 cursor-pointer hover:bg-slate-700-50" data-drawer-toggle="drawer-swipe">
                    <span class="absolute w-8 h-1 -translate-x-1/2 bg-slate-600 rounded-sm top-3 left-1/2"></span>
                    <h5 id="drawer-swipe-label" class="inline-flex items-center text-sm uppercase text-slate-200 font-medium">
                        <svg class="w-5 h-5 mr-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg><span class="font-bold">About</span></h5>
                </div>
                <div class="container mx-auto flex justify-between pb-12 text-slate-200">
                    <div class="basis-1/2 pr-12">
                       <img src="./img/majidata-logo-2.png" alt="Majidata" class="h-12 mx-auto mt-12 mb-6">
                        <p class="mb-4">MajiData was launched as the pro-poor database of the Kenyan water sector covering all urban low income areas in Kenya. A comprehensive data collection exercise started in 2009 and ended in 2011. More than 1800 urban low income areas in 212 cities and towns of Kenya were mapped and the data captured. In 2016, the database was updated. Developed initially by WASREB and WSTF with the support of GIZ through Water Sector Reform Programme, the database has now grown with the vision of being the repository for georeferenced water services data.</p>
                        <p>This new version of Majidata offers not only the pro-poor information and sanitation infrastructure, but also Water Service Providers' service area maps, networks and small scale service providers within the counties.</p>
                    </div>
                    <div class="basis-1/2 pl-12 border-l border-slate-500">
                        <img src="./img/wtf-logo.png" alt="Water Sector Trust Fund" class="h-24 mx-auto mb-6">
                        <p class="mb-4">The Water Sector Trust Fund (WaterFund) is a Kenyan State Corporation under the Ministry of Water & Sanitation and Irrigation and established under the Water Act, 2016, with the mandate to provide conditional and unconditional grants to the Counties and to assist in financing the development of and management of water and sanitation services in the marginalised and underserved areas.</p>
                        <p>It previously existed as the Water Services Trust Fund prior to the repeal of the Water Act, 2002, which had established it.</p>
                    </div>
                </div>
            </div>

        </footer>
  
  <!-- request for data  -->
  <div id="request-for-data-modal" tabindex="-1" aria-hidden="true" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 p-4 w-full md:inset-0 h-modal md:h-full">
      <div class="relative w-full max-w-md h-full md:h-auto">
          <!-- Modal content -->
          <div class="relative bg-white rounded-md shadow-lg">
              <button type="button" class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-800 dark:hover:text-white" data-modal-toggle="request-for-data-modal">
                  <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                  <span class="sr-only">Close modal</span>
              </button>
              <div class="py-6 px-6 lg:px-8">
                  <h3 class="mb-4 text-xl font-medium text-gray-900 dark:text-white">Request for data</h3>
                  <form class="space-y-6" action="#">
                      <div>
                          <label for="email" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Your email</label>
                          <input type="email" name="email" id="email" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-md focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 " placeholder="name@company.com" required>
                      </div>
                      
                      <button class="w-full text-white bg-slate-700 hover:bg-slate-600 font-medium rounded-md text-sm px-5 py-2.5 text-center uppercase">Submit request</button>
                      
                  </form>
              </div>
          </div>
      </div>
  </div> 

   <!-- contact us  -->
   <div id="contact-us-modal" tabindex="-1" aria-hidden="true" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 p-4 w-full md:inset-0 h-modal md:h-full">
    <div class="relative w-full max-w-md h-full md:h-auto">
        <!-- Modal content -->
        <div class="relative bg-white rounded-md shadow-lg">
            <button type="button" class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-800 dark:hover:text-white" data-modal-toggle="contact-us-modal">
                <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                <span class="sr-only">Close modal</span>
            </button>
            <div class="py-6 px-6 lg:px-8">
                <h3 class="mb-4 text-xl font-medium text-gray-900 dark:text-white">Contact us</h3>
                <form class="space-y-6" action="#">
                    <div>
                        <label for="email" class="block mb-2 text-sm font-medium text-gray-900">Your email</label>
                        <input type="email" name="email" id="email" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-md focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 " placeholder="name@company.com" required>
                    </div>

                    <div>
                        <label for="phone" class="block mb-2 text-sm font-medium text-gray-900">Your phone</label>
                        <input type="tel" name="phone" id="phone" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-md focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 ">
                    </div>

                    <div>
                        <label for="phone" class="block mb-2 text-sm font-medium text-gray-900">Message/Enquiry</label>
                       <textarea class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-md focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 "></textarea>
                    </div>
                    
                    
                    <button class="w-full text-white bg-slate-700 hover:bg-slate-600 font-medium rounded-md text-sm px-5 py-2.5 text-center uppercase">Get in touch</button>
                    
                </form>
            </div>
        </div>
      </div>
     </div>
  
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
        <script type="text/javascript" src="https://openlayers.org/en/latest/legacy/ol.js"></script>
        <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL,Object.assign"></script>
        <script type="text/javascript" src="./dist/ol-ext.js"></script>
        <!-- Pointer events polyfill for old browsers, see https://caniuse.com/#feat=pointer -->
        <script src="https://unpkg.com/elm-pep"></script>
        <script type="text/javascript">
                            get_analytics_geojson();

                        async function get_analytics_geojson(){

                            let res = await axios.get('http://102.37.157.16:8080/geoserver/PUBLIC_PORTAL/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=PUBLIC_PORTAL%3Akpi_county&maxFeatures=2350&outputFormat=application%2Fjson');  
                            const all_indicators = JSON.parse(JSON.stringify(res.data.features));

                            console.log("RES", all_indicators);
                            let sum_ps = 0;
                            let sum_psa = 0;
                            let wp = 0;
                            let bv = 0;
                            let nac = 0;
                            let ntc = 0;

                            let awc = 0;
                            let nmc = 0;


                            for (let i = 0; i < all_indicators.length; i++) {
                                const pop_served = all_indicators[i].properties.population_served;
                                const pop_service_area = all_indicators[i].properties.population_service_area;

                                const water_produced = all_indicators[i].properties.water_produced;
                                const billed_volume = all_indicators[i].properties.billed_volume;

                                const active_connections = all_indicators[i].properties.active_connections;
                                const staff_total = all_indicators[i].properties.staff_total;

                                const active_water_connections = all_indicators[i].properties.active_water_connections;
                                const metered_connections = all_indicators[i].properties.metered_connections;

                            //Water coverge
                                sum_ps += pop_served;
                                sum_psa += pop_service_area;

                                //Non Revenue Water
                                wp += water_produced;
                                bv += billed_volume;

                                //Staff productivity
                                nac += active_connections;
                                ntc += staff_total;

                                //Metering Ratio
                                awc += active_water_connections;
                                nmc += metered_connections;

                            }
                        
                            let national_water_coverage = ((sum_ps/sum_psa) * 100).toFixed(0);
                            let non_revenue_water = (((wp-bv)/wp) * 100).toFixed(0);
                            let staff_productivity = ((ntc/nac) * 1000).toFixed(0);
                            let metering_ratio = (((nmc/awc)) * 100).toFixed(0);

                            $('#national_wc').html(national_water_coverage);
                            $('#national_nrw').html(non_revenue_water);
                            $('#national_metering_ratio').html(metering_ratio);
                            $('#population_served').html(sum_ps.toLocaleString());
                            $('#population_service_area').html(sum_psa.toLocaleString());
                            $('#active_water_connections').html(awc.toLocaleString());
                            $('#water_produced').html(wp.toLocaleString());

                            console.log("Natioanl", nmc);
                            //$("#county_level").hide();
                        // $('#myTable tbody').append('<tr class ="table_class" id="table_id" data-name="' + name + '"><td>XXXX</td></tr>');
                        //$('#water_coverage').append('<div data-end-value="' + national_water_coverage + '" class="circular-progress circular-progress-small mx-auto"><div class="value-container value-container-small text-slate-600">0%</div></div>');
                        // $("#water_coverage").data-end("92", national_water_coverage);

                        //var startTime = national_water_coverage.getAttribute('data-end-value');
                        // var startTime = $('.water_coverage').getAttribute('data-end-value');
                        // console.log("Startr",startTime)


                        //const element = document.querySelector("#water_coverage");
                    //  delete element.dataset.attributeName;

                        //const t = '67';
                        // $("#water_coverage").attr("data-end-value", t); 
                        //console.log($("#water_coverage").data("end-value"));

                        
                        }


                        var popup = new ol.Overlay({ element: document.getElementById('popup')});

                        let bounds = [3299284.34,-318150.43,5155786.89,415645.04];
                        let format  = 'image/png';
                        let asa = new ol.source.TileWMS({
                                    url: 'http://102.37.157.16:8080/geoserver/WASREB/wms?authkey=488c54cd-6392-4d20-953d-b522f791a23e',
                                    params: {'FORMAT': 'image/png', 
                                            'VERSION': '1.1.1',
                                            tiled: true,
                                            "AUTHKEY": '488c54cd-6392-4d20-953d-b522f791a23e',
                                            "STYLES": '',
                                            "LAYERS": 'WASREB:actual_service_area',
                                            "exceptions": 'application/vnd.ogc.se_inimage',
                                            tilesOrigin: 3797753 + "," + -519815.0625
                                        }
                                    })

                                    //   let county_boundaries = new ol.source.TileWMS({
                                    //       url: 'http://102.37.157.16:8080/geoserver/WASREB/wms',
                                    //       params: {'FORMAT': 'image/png', 
                                    //               'VERSION': '1.1.1',
                                    //               tiled: true,
                                    //             "STYLES": '',
                                    //             "LAYERS": 'WASREB:county',
                                    //             "exceptions": 'application/vnd.ogc.se_inimage',
                                    //         tilesOrigin: 3774876 + "," + -521207.03125
                                    //       }
                                    //     })

                                        let county_boundaries_json = new ol.source.Vector({
                                                                projection : 'EPSG:3857',
                                                                url: 'http://102.37.157.16:8080/geoserver/WASREB/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=WASREB%3Acounty&maxFeatures=50&outputFormat=application%2Fjson&authkey=488c54cd-6392-4d20-953d-b522f791a23e',
                                                                format: new ol.format.GeoJSON()
                                                            });


                                    //    let licensed_service_Area = new ol.source.TileWMS({
                                    //           url: 'http://102.37.157.16:8080/geoserver/WASREB/wms',
                                    //           params: {'FORMAT': format, 
                                    //                   'VERSION': '1.1.1',
                                    //                   tiled: true,
                                    //                 "STYLES": '',
                                    //                 "LAYERS": 'WASREB:licensed_service_area',
                                    //                 "exceptions": 'application/vnd.ogc.se_inimage',
                                    //             tilesOrigin: 35.654788970947266 + "," + -383890.0625
                                    //           }
                                    //       })


                                    let licensed_service_Area_json = new ol.source.Vector({
                                                                projection : 'EPSG:3857',
                                                                url: 'http://102.37.157.16:8080/geoserver/WASREB/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=WASREB%3Alicensed_service_area&maxFeatures=3050&outputFormat=application%2Fjson&authkey=488c54cd-6392-4d20-953d-b522f791a23e',
                                                                format: new ol.format.GeoJSON()
                                                            });
                                        
                                    //   let low_income_area = new ol.source.TileWMS({
                                    //         url: 'http://102.37.157.16:8080/geoserver/WASREB/wms',
                                    //         params: {'FORMAT': format, 
                                    //                 'VERSION': '1.1.1',
                                    //                 tiled: true,
                                    //               "STYLES": '',
                                    //               "LAYERS": 'WASREB:low_income_area',
                                    //               "exceptions": 'application/vnd.ogc.se_inimage',
                                    //           tilesOrigin: -59942.10546875 + "," + 9545509
                                    //         }
                                    //     }) 

                                    let low_income_area_json = new ol.source.Vector({
                                                                projection : 'EPSG:3857',
                                                                url: 'http://102.37.157.16:8080/geoserver/WASREB/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=WASREB%3Alow_income_area&maxFeatures=3050&outputFormat=application%2Fjson&authkey=488c54cd-6392-4d20-953d-b522f791a23e',
                                                                format: new ol.format.GeoJSON()
                                                            });

                                    //  let sanitation_facilities = new ol.source.TileWMS({
                                    //       url: 'http://102.37.157.16:8080/geoserver/WASREB/wms',
                                    //       params: {'FORMAT': format, 
                                    //               'VERSION': '1.1.1',
                                    //               tiled: true,
                                    //             "STYLES": '',
                                    //             "LAYERS": 'WASREB:sanitation_facility',
                                    //             "exceptions": 'application/vnd.ogc.se_inimage',
                                    //         tilesOrigin: 3919555.25 + "," + -46950.8671875
                                    //       }
                                    //   })

                                    let sanitation_facilities_json = new ol.source.Vector({
                                                                projection : 'EPSG:3857',
                                                                url: 'http://102.37.157.16:8080/geoserver/WASREB/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=WASREB%3Asanitation_facility&maxFeatures=30050&outputFormat=application%2Fjson&authkey=488c54cd-6392-4d20-953d-b522f791a23e',
                                                                format: new ol.format.GeoJSON()
                                                            });

                                    //  let sewer_manhole =  new ol.source.TileWMS({
                                    //       url: 'http://102.37.157.16:8080/geoserver/WASREB/wms',
                                    //       params: {'FORMAT': format, 
                                    //               'VERSION': '1.1.1',
                                    //               tiled: true,
                                    //             "STYLES": '',
                                    //             "LAYERS": 'WASREB:sewer_manhole',
                                    //             "exceptions": 'application/vnd.ogc.se_inimage',
                                    //         tilesOrigin: 3837016.75 + "," + -134548.046875
                                    //       }
                                    //     })

                                        let sewer_manhole_json = new ol.source.Vector({
                                                                projection : 'EPSG:3857',
                                                                url: 'http://102.37.157.16:8080/geoserver/WASREB/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=WASREB%3Asewer_manhole&maxFeatures=3050&outputFormat=application%2Fjson&authkey=488c54cd-6392-4d20-953d-b522f791a23e',
                                                                format: new ol.format.GeoJSON()
                                                            });

                                    //   let sewer_pipeline =  new ol.source.TileWMS({
                                    //         url: 'http://102.37.157.16:8080/geoserver/WASREB/wms',
                                    //         params: {'FORMAT': format, 
                                    //                 'VERSION': '1.1.1',
                                    //                 tiled: true,
                                    //               "STYLES": '',
                                    //               "LAYERS": 'WASREB:sewer_pipeline',
                                    //               "exceptions": 'application/vnd.ogc.se_inimage',
                                    //           tilesOrigin: 3864569.5 + "," + -134548.046875
                                    //         }
                                    //       })

                                        let sewer_pipeline_json = new ol.source.Vector({
                                                                projection : 'EPSG:3857',
                                                                url: 'http://102.37.157.16:8080/geoserver/WASREB/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=WASREB%3Asewer_pipeline&maxFeatures=10030050&outputFormat=application%2Fjson&authkey=488c54cd-6392-4d20-953d-b522f791a23e',
                                                                format: new ol.format.GeoJSON()
                                                            });

                                        // let sssp_shemes =  new ol.source.TileWMS({
                                        //     url: 'http://102.37.157.16:8080/geoserver/WASREB/wms',
                                        //     params: {'FORMAT': format, 
                                        //             'VERSION': '1.1.1',
                                        //             tiled: true,
                                        //           "STYLES": '',
                                        //           "LAYERS": 'WASREB:sssp_scheme',
                                        //           "exceptions": 'application/vnd.ogc.se_inimage',
                                        //       tilesOrigin: 3778598 + "," + -522885.53125
                                        //     }
                                        //   })

                                        let sssp_shemes_json = new ol.source.Vector({
                                                                projection : 'EPSG:3857',
                                                                url: 'http://102.37.157.16:8080/geoserver/WASREB/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=WASREB%3Asssp_scheme&maxFeatures=3050&outputFormat=application%2Fjson&authkey=488c54cd-6392-4d20-953d-b522f791a23e',
                                                                format: new ol.format.GeoJSON()
                                                            });

                                        let wwda =  new ol.source.TileWMS({
                                            url: 'http://102.37.157.16:8080/geoserver/WASREB/wms',
                                            params: {'FORMAT': format, 
                                                    'VERSION': '1.1.1',
                                                    tiled: true,
                                                    "STYLES": '',
                                                    "LAYERS": 'WASREB:wwda',
                                                    "exceptions": 'application/vnd.ogc.se_inimage',
                                                tilesOrigin: -67084.8046875 + "," + 9482734
                                            }
                                            })


                                            //Indicators

                                        let water_coverage = new ol.source.TileWMS({
                                                url: 'http://102.37.157.16:8080/geoserver/PUBLIC_PORTAL/wms',
                                                params: {'FORMAT': format, 
                                                        'VERSION': '1.1.1',
                                                        tiled: true,
                                                    "STYLES": 'water_coverage_2',
                                                    "LAYERS": 'PUBLIC_PORTAL:kpi_county',
                                                    "exceptions": 'application/vnd.ogc.se_inimage',
                                                tilesOrigin: 3774876.0657275263 + "," + -521207.0057444413
                                                }
                                        })

                                        let non_revenue_water = new ol.source.TileWMS({
                                                url: 'http://102.37.157.16:8080/geoserver/PUBLIC_PORTAL/wms',
                                                params: {'FORMAT': format, 
                                                        'VERSION': '1.1.1',
                                                        tiled: true,
                                                    "STYLES": 'nrw',
                                                    "LAYERS": 'PUBLIC_PORTAL:kpi_county',
                                                    "exceptions": 'application/vnd.ogc.se_inimage',
                                                tilesOrigin: 3774876.0657275263 + "," + -521207.0057444413
                                                }
                                        })

                                        let metering_ratio = new ol.source.TileWMS({
                                                url: 'http://102.37.157.16:8080/geoserver/PUBLIC_PORTAL/wms',
                                                params: {'FORMAT': format, 
                                                        'VERSION': '1.1.1',
                                                        tiled: true,
                                                    "STYLES": '	metering_ratio',
                                                    "LAYERS": 'PUBLIC_PORTAL:kpi_county',
                                                    "exceptions": 'application/vnd.ogc.se_inimage',
                                                tilesOrigin: 3774876.0657275263 + "," + -521207.0057444413
                                                }
                                        })

                                        let wsp_water_coverage = new ol.source.TileWMS({
                                                url: 'http://102.37.157.16:8080/geoserver/PUBLIC_PORTAL/wms',
                                                params: {'FORMAT': format, 
                                                        'VERSION': '1.1.1',
                                                        tiled: true,
                                                    "STYLES": 'water_coverage_2',
                                                    "LAYERS": 'PUBLIC_PORTAL:kpi_wsp_v',
                                                    "exceptions": 'application/vnd.ogc.se_inimage',
                                                tilesOrigin: 3774876.0657275263 + "," + -521207.0057444413
                                                }
                                        })

                                        let wsp_non_revenue = new ol.source.TileWMS({
                                                url: 'http://102.37.157.16:8080/geoserver/PUBLIC_PORTAL/wms',
                                                params: {'FORMAT': format, 
                                                        'VERSION': '1.1.1',
                                                        tiled: true,
                                                    "STYLES": 'nrw',
                                                    "LAYERS": 'PUBLIC_PORTAL:kpi_wsp_v',
                                                    "exceptions": 'application/vnd.ogc.se_inimage',
                                                tilesOrigin: 3774876.0657275263 + "," + -521207.0057444413
                                                }
                                        })

                                        var style = new ol.style.Style({
                                            stroke: new ol.style.Stroke({
                                            color: '#42414D',
                                            width: 2,
                                            }),
                                            text: new ol.style.Text({
                                            font: '19px Calibri,sans-serif',
                                            fill: new ol.style.Fill({
                                                color: '#000'
                                            }),
                                            stroke: new ol.style.Stroke({
                                                color: '#fff',
                                                width: 2
                                                }),
                                            })
                                        });

                                    let county_boundaries_style =  function(feature) {
                                            style.getText().setText(feature.get('name'));
                                            return style;
                                        };

                                        


                                    const wwdaa = new ol.layer.Tile({ visible: false, source: wwda, title:'Water Works and Development Agencies' });

                                    // list of layers
                                    var layers = [	
                                    
                                    // new ol.layer.Tile({ source: new ol.source.Stamen({ layer: 'toner-background' }), title:'toner-background' }),
                                    // new ol.layer.Tile({ source: new ol.source.Stamen({ layer: 'terrain-background' }), title:'terrain-background' }),
                                    // new ol.layer.Tile({ source: new ol.source.Stamen({ layer: 'toner-lines' }), title:'toner-lines' }),
                                    new ol.layer.Group({ title: '<b>BASEMAPS</b><br>', openInLayerSwitcher: true, layers: [
                                    new ol.layer.Tile({ visible: true, source:  new ol.source.OSM(), title:'Basemap OSM' }),
                                    new ol.layer.Tile({ visible: false ,source: new ol.source.Stamen({ layer: 'terrain-background' }), title:'terrain-background' }),
                                    //new ol.layer.Tile({ visible: false ,source: new ol.source.Stamen({ layer: 'toner-lines' }), title:'toner-lines' }),
                                    new ol.layer.Vector({  visible: true, source: county_boundaries_json, title:'County Boundaries' }),
                                    wwdaa
                                    ]}),
                                    new ol.layer.Group({ title: '<b>WATER UTILITIES AND SERVICE AREAS</b>', openInLayerSwitcher: true, layers: [
                                    
                                    new ol.layer.Vector({ visible: false, source: sewer_pipeline_json, title:'Sewer Pipelines' }),
                                    new ol.layer.Vector({ visible: false, source: sewer_manhole_json, title:'Sewer Manholes' }),
                                    new ol.layer.Vector({ visible: false, source: sanitation_facilities_json, title:'Sanitation Facilities' }),
                                    new ol.layer.Vector({ visible: false,source: low_income_area_json, title:'Low Income Areas' }),
                                    new ol.layer.Vector({ visible: false,source: licensed_service_Area_json, title:'Licensed Service Areas' }),
                                    new ol.layer.Vector({ visible: false, source: sssp_shemes_json, title:'SSSPs Schemes' }),
                                    //new ol.layer.Tile({ visible: false, source: asa, title:'Actual Service Areas' }),
                                        
                                ]}),
                                    new ol.layer.Group({ title: '<b>WSP PERFORMANCE INDICATORS/ANALYTICS</b><br>', openInLayerSwitcher: true, layers: [
                                    new ol.layer.Tile({ visible: false, source: wsp_non_revenue, title:'WSP Non Revenue Water' }),
                                    //new ol.layer.Tile({ visible: false, source: metering_ratio, title:'Metering Ratio' }),
                                    new ol.layer.Tile({ visible: false, source: wsp_water_coverage, title:'WSP Water Coverage' }),
                                    //new ol.layer.Tile({ visible: false, source: metering_ratio, title:'Metering Ratio' })
                                    //new ol.layer.Tile({ source: new ol.source.Stamen({ layer: 'terrain-labels' }), title:'County Boundaries' }),
                                ]}),
                                    new ol.layer.Group({ title: '<b>COUNTY PERFORMANCE INDICATORS/ANALYTICS</b><br>', openInLayerSwitcher: true, layers: [
                                    new ol.layer.Tile({ visible: false, source: non_revenue_water, title:'Non Revenue Water' }),
                                    new ol.layer.Tile({ visible: false, source: metering_ratio, title:'Metering Ratio' }),
                                    new ol.layer.Tile({ visible: true, source: water_coverage, title:'Water Coverage' }),
                                    //new ol.layer.Tile({ visible: false, source: metering_ratio, title:'Metering Ratio' })
                                    //new ol.layer.Tile({ source: new ol.source.Stamen({ layer: 'terrain-labels' }), title:'County Boundaries' }),
                            ]})
                                
                            ];

                            var osmLayer = new ol.layer.Tile({
                            source: new ol.source.OSM()
                            });

                            
                            let view = new ol.View({ zoom: 15, center: [0.340505, 37.310292] });
                        
                            // The Map
                            let map = new ol.Map({
                            
                            target: 'map',
                            view: view,
                            layers: layers,
                            overlays: [popup]
                            });


                            map.getView().fit(bounds, map.getSize());
                            // Add a layer switcher outside the map
                            var lswitcher = new ol.control.LayerSwitcher({
                            target:$(".layerSwitcher").get(0),
                            selection:true,
                            allwaysOnTop:true,
                            extent:true

                            });

                            // Show or hide elements
                            $("#county_level").hide();

                            var fullscreen = new ol.control.FullScreen();
                            map.addControl(fullscreen);

                            const root = map.getLayerGroup();
                            const performance_indicators_analytics = root.getLayers().item(1);

                           
                        
                            var parser = new ol.format.WMSGetFeatureInfo();

                            lswitcher.on('select', function(e) {
                                let selected_layer = e.layer;
                                console.log("Selectable", e);
                                const performance_indicators_analytics = root.getLayers().item(3);
                                console.log("Toogle", performance_indicators_analytics);
                               // console.log("Performance indicators", performance_indicators_analytics.getLayers().getArray());

                               for (let f = 0; f < performance_indicators_analytics.getLayers().getArray().length; f++) { 
                               
                                 let pia =  performance_indicators_analytics.getLayers().item(f);
                                 

                                 if(pia.get('visible')){

                                     // console.log("Pia title", pia.get('title'));
                                     //console.log("Checked title", e.layer.get('title'));
                                     if(pia.get('title') != e.layer.get('title')){

                                        pia.setVisible(false);

                                     }

                                     window.localStorage.setItem('selected_indicator', e.layer.get('title'));

                                    // console.log("Pia title", e.layer);


                                   }




                            
                                }


                               //map.getView().fit(selected_layer.getGeometry())
                                

                            });


                            $("#nrw").hide();
                            $("#water_coverage").hide();
                            $("#nrw_county").hide();
                            $("#metering_ratio_county").hide();
                            $("#water_coverage_county").hide();  
                            $("#water_coverage_stats").hide();
                            $("#metering_ratio_stats").hide();
                            $("#non_revenue_county").hide();
                            $("#non_revenue_stats").hide();

                            map.on('singleclick', function(evt) { 
                                
                                $(".indicators-container").addClass('show').removeClass('hidden');
                                $(".all_layers").addClass('show').removeClass('hidden');

                                $("#national_level").hide();
                                $("#county_level").show();
                            
                                let feature = map.forEachFeatureAtPixel (evt.pixel, function (feature) {return feature;});
                            // feature.setStyle(county_boundaries_style);
                                //console.log("Feature", feature.getGeometry());
                                map.getView().fit(feature.getGeometry())

                                console.log("Properties", feature.getProperties().name);
                                //$("#county_name").html(feature.getProperties().name);
                                //map.getView().setZoom(10);
                                // Attempt to find a marker from the planningAppsLayer
                                // var feature = layers.forEachFeatureAtPixel(evt.pixel, function(feature, layer) {
                                //     return feature;
                                // });

                                // var select_interaction = new ol.interaction.Select();

                                // select_interaction.getFeatures().on("add", function (e) { 
                                //     var feature = e.element; //the feature selected
                                //     console.log("SELECT", feature);
                                // });

                            // console.log("SELECT", select_interaction);



                                const viewProjection = view.getProjection();
                                var viewResolution = view.getResolution();

                                const root = map.getLayerGroup();
                                
                                const water_utilities_service_area = root.getLayers().item(1);
                                const performance_indicators_analytics = root.getLayers().item(3);
                                
                                //Performance Indicators

                                const county_non_revenue= performance_indicators_analytics.getLayers().item(0);
                                const county_water_coverage= performance_indicators_analytics.getLayers().item(0);


                                //Water utilities
                                const sewer_pipeline= water_utilities_service_area.getLayers().item(0);
                                const sewer_manhole= water_utilities_service_area.getLayers().item(1);
                                const sanitation_facilities= water_utilities_service_area.getLayers().item(2);
                                const low_income_areas= water_utilities_service_area.getLayers().item(3);
                                const licensed_service_areas = water_utilities_service_area.getLayers().item(4);
                                const actual_service_area = water_utilities_service_area.getLayers().item(5);
                                
                                //Performance Indicators
                                for (let f = 0; f < performance_indicators_analytics.getLayers().getArray().length; f++) { 

                                    let pia =  performance_indicators_analytics.getLayers().item(f);
                                        
                                        if(pia.get('visible')){
                                           // $("#national_level").hide();
                                        //console.log("L", pia.get('visible'), "Layer name", pia);

                                            var pixel = map.getEventPixel(evt.originalEvent);

                                            var url = pia.getSource().getFeatureInfoUrl(
                                                    evt.coordinate, viewResolution, viewProjection,
                                                                    {'INFO_FORMAT': 'application/json'})
                                                pia.setZIndex(f);

                                                $("#county_levels").show();
                                            
                                                $.ajax({url: url,
                                                    dataType: 'json',
                                                    success:function(response) {

                                                        var result = response;
                                                        
                                                        if(result.features.length != 0){

                                                            // wusa.setZIndex(99);
                                                            
                                                            //var te = new ol.format.GML2();

                                                            //var a = te.readFeatures(response)
                                                            //ar feature = new ol.Feature(a);
                                                            
                                                           // console.log("Pia JSON", result.features);

                                                            //var extent = pia.getExtent();
                                                            
                                                           
                                                           
                                                           // $("#county_name").html(pia.get('title')); feature.getProperties().name
                                                            //alert(wusa.get('title'));
                                                            
                                                           

                                                            // console.log("Layer23", result.features[0].geometry.coordinates[0][0]);
                                                            // var extent = result.features.getGeometry().getExtent().slice(0);

                                                            var countryStyle = new ol.style.Style({
                                                                fill: new ol.style.Fill({
                                                                color: [203, 194, 185, 1],
                                                                width: 2
                                                                })
                                                            });

                                                            var vectorSource = new ol.source.Vector({
                                                                projection : 'EPSG:3857',
                                                                url: url,
                                                                format: new ol.format.GeoJSON()
                                                            });

                                                            var vectorLayer = new ol.layer.Vector({
                                                                    source: vectorSource
                                                            });

                                                            const pia_title = pia.get('title');

                                                           // console.log("Results", result.features, "Get Title", pia.get('title'));
                                                            const featureu = map.forEachFeatureAtPixel(evt.pixel, (feature) => {
                                                                return feature;
                                                            }); 

                                                            const cat = window.localStorage.getItem(pia_title);


                                                            const indicator_title_layer = window.localStorage.getItem("selected_indicator");
                                                            $("#selected_indicator_checkbox").html(indicator_title_layer);
                                                            $(".county_name").html(indicator_title_layer);

                                                            if(indicator_title_layer == pia_title){

                                                                console.log("Feature", result.features[0].properties);
                                                                console.log("Checkmate", result.features[0].properties.water_produced);
                                                                
                                                                if(indicator_title_layer== "Non Revenue Water")
                                                                {
                                                                    $("#non_revenue_county").show();

                                                                    const county_name = result.features[0].properties.name;
                                                                    
                                                                    $(".county_name_indicator_nrw").html(county_name);

                                                                    $("#water_coverage_county").hide();
                                                                    $("#water_coverage_stats").hide();

                                                                    $("#metering_ratio_stats").hide();
                                                                    $("#metering_ratio_county").hide();


                                                                    const water_produced = result.features[0].properties.water_produced;
                                                                    const billed_volume = result.features[0].properties.billed_volume;

                                                                    let non_revenue_water = (((water_produced-billed_volume)/water_produced) * 100).toFixed(1);

                                                                    $("#water_produced_indicator_nrw").html(result.features[0].properties.water_produced.toLocaleString());
                                                                    $("#billed_volume_indicator_nrw").html(result.features[0].properties.billed_volume.toLocaleString());
                                                                    $("#indicator_value_nrw").html(non_revenue_water); 
                                                                   // $("#nrw").show();
                                                                    //$("#water_coverage").hide();


                                                                } 

                                                                if(indicator_title_layer== "Metering Ratio")
                                                                {
                                                                    
                                                                    $("#metering_ratio_county").show();
                                                                    
                                                                    const county_name = result.features[0].properties.name;
                                                                    
                                                                    $(".county_name_indicator_mr").html(county_name);
                                                                    $("#metering_ratio_stats").show();

                                                                    $("#water_coverage_county").hide();
                                                                    $("#water_coverage_stats").hide();

                                                                    $("#non_revenue_county").hide();
                                                                    $("#non_revenue_stats").hide();
                                                                    
                                                                    const active_water_connections = result.features[0].properties.active_water_connections;
                                                                    const metered_connections = result.features[0].properties.metered_connections;

                                                                    
                                               
                                                                    let county_metering_ratio = (((metered_connections/active_water_connections)) * 100).toFixed(1);
                                                                    $(".indicator_value_mr").html(county_metering_ratio); 

                                                                    $(".active_water_connections_mr").html(active_water_connections.toLocaleString());
                                                                    $(".number_metered_connections_mr").html(metered_connections.toLocaleString());
                                                                   // $("#nrw_county").html(non_revenue_water); 
                                                                    //$("#nrw").show();
                                                                    //$("#water_coverage").hide();

                                                                   // const water_coverage_color = document.getElementById("meter_ratio_color_wc");
                                                                    if(county_metering_ratio < 95)
                                                                    {
                                                                        document.getElementById("meter_ratio_color_wc").style.background = "rgb(220, 53, 69)";
                                                                    }
                                                                    else if(county_metering_ratio > 95 &&  county_metering_ratio < 99)
                                                                    {   
                                                                        document.getElementById("meter_ratio_color_wc").style.background = "#FFD300";
                                                                    }
                                                                    else if(county_metering_ratio == 100)
                                                                    {
                                                                        document.getElementById("meter_ratio_color_wc").style.background = "#12863C";
                                                                    }

                                                                } 

                                                                if(indicator_title_layer== "Water Coverage")
                                                                {
                                                                    const county_name = result.features[0].properties.name;
                                                                   
                                                                    $(".county_name_indicator_wc").html(county_name);
                                                                    $("#water_coverage_county").show();
                                                                    $("#water_coverage_stats").show();

                                                                    $("#metering_ratio_stats").hide();
                                                                    $("#metering_ratio_county").hide();

                                                                    $("#non_revenue_county").hide();
                                                                    $("#non_revenue_stats").hide();
                                                                    
                                                                    const pop_served = result.features[0].properties.population_served;
                                                                    const pop_service_area = result.features[0].properties.population_service_area;

                                                                    
                                               
                                                                    let county_water_coverage = ((pop_served/pop_service_area) * 100).toFixed(0);
                                                                    $(".indicator_value_wc").html(county_water_coverage); 

                                                                    $(".population_served_wc").html(pop_served.toLocaleString());
                                                                    $(".population_service_area_wc").html(pop_service_area.toLocaleString());
                                                                   // $("#nrw_county").html(non_revenue_water); 
                                                                    //$("#nrw").show();
                                                                    //$("#water_coverage").hide();

                                                                    const water_coverage_color = document.getElementById("water_coverage_color");
                                                                    if(county_water_coverage < 80)
                                                                    {
                                                                        document.getElementById("water_coverage_color_wc").style.background = "rgb(220, 53, 69)";
                                                                    }
                                                                    else if(county_water_coverage > 80 &&  county_water_coverage < 90)
                                                                    {   
                                                                        document.getElementById("water_coverage_color_wc").style.background = "#FFD300";
                                                                    }
                                                                    else if(county_water_coverage > 90)
                                                                    {
                                                                        document.getElementById("water_coverage_color_wc").style.background = "#12863C";
                                                                    }



                                                                }

                                                                if(indicator_title_layer== "Non Revenue Water")
                                                                {
                                                                    const county_name = result.features[0].properties.name;
                                                                   
                                                                    $(".county_name_indicator_wc").html(county_name);
                                                                    $("#water_coverage_county").show();
                                                                    $("#water_coverage_stats").show();

                                                                    $("#metering_ratio_stats").hide();
                                                                    $("#metering_ratio_county").hide();

                                                                    $("#non_revenue_county").hide();
                                                                    $("#non_revenue_stats").hide();
                                                                    
                                                                    const pop_served = result.features[0].properties.population_served;
                                                                    const pop_service_area = result.features[0].properties.population_service_area;

                                                                    
                                               
                                                                    let county_water_coverage = ((pop_served/pop_service_area) * 100).toFixed(0);
                                                                    $(".indicator_value_wc").html(county_water_coverage); 

                                                                    $(".population_served_wc").html(pop_served.toLocaleString());
                                                                    $(".population_service_area_wc").html(pop_service_area.toLocaleString());
                                                                   // $("#nrw_county").html(non_revenue_water); 
                                                                    //$("#nrw").show();
                                                                    //$("#water_coverage").hide();

                                                                    const water_coverage_color = document.getElementById("water_coverage_color");
                                                                    if(county_water_coverage < 80)
                                                                    {
                                                                        document.getElementById("water_coverage_color_wc").style.background = "rgb(220, 53, 69)";
                                                                    }
                                                                    else if(county_water_coverage > 80 &&  county_water_coverage < 90)
                                                                    {   
                                                                        document.getElementById("water_coverage_color_wc").style.background = "#FFD300";
                                                                    }
                                                                    else if(county_water_coverage > 90)
                                                                    {
                                                                        document.getElementById("water_coverage_color_wc").style.background = "#12863C";
                                                                    }



                                                                } 


                                                            }


                                                            
                                                        
                                                        // view.fit(vectorLayer.getGeometry())
                                                        // map.getView().fit(vectorLayer.getSource().getExtent(), map.getSize());
                                                            //console.log("Vector Layer", vectorLayer);

                                                            //var extent = vectorLayer.getSource().getExtent();
                                                        // console.log("Kiambu");
                                                            //map.getView().getCenter()
                                                            //map.getView().fit(extent, {size:map.getSize(), maxZoom:16})
                                                            // var feature = response.features[0];
                                                            // var extent = feature.getGeometry().getExtent()
                                                            // console.log("Results pia", extent);

                                                            
                                                            // map.getView().setZoom(result.features[0].geometry.coordinates[0][0]);
                                                            //console.log("Geometry", result.features[0].geometry.coordinates, "Get Title", pia.get('title'));
                                                            //map.getView().fit(pia, map.getSize())
                                                            //const geometry = result.features[0].geometry.coordinates;
                                                        // map.getView().fit(geometry.getExtent(), map.getSize());
                                                        // map.zoomToExtent(result.features[0].geometry);


                                                        }
                                                            // if (result.length) {
                                                            // var info2 = [];
                                                            // for (var i = 0, ii = result.length; i < ii; ++i) {
                                                            // info2.push(result[i].get('referencia'));
                                                            // }
                                                            // document.getElementById("Getfeatureinfo").value = info2;

                                                            // } else {
                                                            // document.getElementById("Getfeatureinfo").value = info2;

                                                            // }
                                                    }});




                                        }


                                    }

                                //Water utilities
                                for (let f = 0; f < water_utilities_service_area.getLayers().getArray().length; f++) { 

                                let wusa =  water_utilities_service_area.getLayers().item(f);

                                if(wusa.get('visible')){

                                // console.log("L", wusa.get('visible'), "Layer name", wusa);

                                    var pixel = map.getEventPixel(evt.originalEvent);

                                        var url = wusa.getSource().getFeatureInfoUrl(
                                            evt.coordinate, viewResolution, viewProjection,
                                                            {'INFO_FORMAT': 'application/json'})
                                            wusa.setZIndex(f);
                                        
                                            $.ajax({url: url,
                                                dataType: 'json',
                                                success:function(response) {

                                                    var result = response;
                                                    
                                                    if(result.features.length != 0){

                                                    // wusa.setZIndex(99);
                                                        

                                                        console.log("Results", result.features, "Get Title", wusa.get('title'));
                                                        $("#indicators").hide();
                                                        $("#info-title").html(wusa.get('title'));
                                                        //alert(wusa.get('title'));


                                                    }
                                                        // if (result.length) {
                                                        // var info2 = [];
                                                        // for (var i = 0, ii = result.length; i < ii; ++i) {
                                                        // info2.push(result[i].get('referencia'));
                                                        // }
                                                        // document.getElementById("Getfeatureinfo").value = info2;

                                                        // } else {
                                                        // document.getElementById("Getfeatureinfo").value = info2;

                                                        // }
                                                }});




                                }


                                }




                                //let lay =	layers[1];
                                
                                //var view = map.getView();
                                
                                //var source = layer1.get('visible') ? layer1.getSource() : layer1.getSource();
                                
                                //const viewProjection = map.getView().getProjection();
                                
                                //console.log("GGGGG", layer1.getSource()["getGetFeatureInfoUrl"]);
                                
                                
                                //const viewResolution = view.getResolution();
                                
                                //var feature = map.forEachFeatureAtPixel (evt.pixel, function (feature) {return feature;})
                                //console.log("Feature", feature);

                                //  for (let f = 0; f < layers.length; f++) { 
                                //        let hy = layers[f];

                                //        if(layers[f].getLayers()['ol_uid'] == 33){

                                //            if(layers[f].get('visible')){

                                //              // console.log("Get Layers", layers[i].getLayers());
                                //             //  var url = layers[i].getSource().getFeatureInfoUrl(
                                //             //         evt.coordinate, viewResolution, viewProjection,
                                //             //         {'INFO_FORMAT': 'application/json'});
                                
                                        
                                //                 for (let i = 0; i < layers[i].getLayers().getArray().length; i++) { 

                                                    
                                //                     console.log("LLL1",layers[f].getLayers().item(i));
                                                    


                                //                 }


                                //            }

                                //        }

                                    //    console.log("LLL1", layers[i]);
                                    //    let lyr = hy.getLayers().item(i)
                                    //    console.log("LLL2", lyr);

                                //} 


                                // var url = layer1.getSource().getFeatureInfoUrl(
                                // 		  evt.coordinate, viewResolution, viewProjection,
                                // 		  {'INFO_FORMAT': 'application/json'});
                                
                                
                                
                                //console.log("GetLayers", layer1);
                                
                                //console.log("LAYER", layer1);
                                //console.log("URL", url);
                                
                                // layers.forEach(function(l){
                                //     console.log("Layers outside", layers[0]);
                                //      if (l.getLayers) {

                                //         //console.log("Layers inside", l.getLayers().getArray());

                                //      }

                                // });

                                
                            });


                            //class="form-control" style="margin-bottom:20px !important;"
                            map.addControl(lswitcher);

                            // The serach input
                            var search = $('<input id="main-search" class="form-control" style="color:#293445; margin-bottom:0px !important;">').attr('placeholder','Type To Filter..e.g Water Coverage');
                            function filterLayers(rex, layers) {
                                console.log("REX", rex);
                            var found = false;
                            layers.forEach(function(l){
                                // Layer Group
                                if (l.getLayers) {
                                if (filterLayers(rex, l.getLayers().getArray())) {
                                    l.set('noLayer', false);
                                    found = true;
                                } else {
                                    //l.set('noLayer', true);
                                }
                                } else {
                                if (rex.test(l.get('title'))) {
                                    l.setVisible(true);
                                    found = true;
                                } else {
                                    l.setVisible(false);
                                }
                                }
                            });
                            return found;
                            }
                            search.on('keyup change', function(){
                            var rex = new RegExp(search.val());
                            filterLayers(rex, layers);
                            // Force layer switcher redraw
                            //layers[0].changed();
                            });

                            // Add search input in the switcher header
                            lswitcher.setHeader(search.get(0));

                            lswitcher.on('toggle', function(e) {

                                const performance_indicators_analytics = root.getLayers().item(3);
                               

                            });
                            //

                            // When switcher is drawn hide/show the list item according to its visility
                            lswitcher.on('drawlist', function(e) {
                            // console.log("E layers", e.layer);
                            // Hide Layer Group with no layers visible
                            if (e.layer.get('noLayer')) {
                                if (e.layer.get('noLayer')) {
                              //  $(e.li).hide();
                                } else {
                               // $(e.li).show();
                                }
                            } else {
                                var rex = new RegExp(search.val());
                                if (rex.test(e.layer.get('title'))) {
                                $(e.li).show();
                                } else {
                                $(e.li).hide();
                                }
                            }
                            });

                        
                    </script>

                        <script type="module">
                            import showProgressBar from './script/show-progress-bar.js'

                            const progressBars = Array.from(document.querySelectorAll('.circular-progress'))

                            // TANUI: make your changes here. Ignore everythig above
                            //  the lowerThreshold and upperThreshold figures are based on the sector benchmark for each KPI
                            progressBars.forEach(progressBar =>
                                showProgressBar({
                                    lowerThreshold: 80,
                                    upperThreshold: 90,
                                    progressBar
                                })
                            )

                            const indicatorsToggle = document.querySelector('#indicators-toggle')
                                const indicatorsContainer = document.querySelector('#indicators-container')
                                const layersToggle = document.querySelector('#layers-toggle')
                                const layersContainer = document.querySelector('#layer-items')

                                indicatorsToggle.addEventListener('click', () =>
                                    toggleDiv(indicatorsContainer)
                                )
                                layersToggle.addEventListener('click', () => toggleDiv(layersContainer))


                                const toggleDiv = divToToggle => {
                                    if (divToToggle.classList.contains('hidden')) {
                                        divToToggle.classList.remove('hidden')
                                        divToToggle.classList.add('visible')
                                    } else {
                                        divToToggle.classList.remove('visible')
                                        divToToggle.classList.add('hidden')
                                    }
                                }
                 </script>
    </body>
</html>